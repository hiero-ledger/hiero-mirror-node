{
  "info": {
    "_postman_id": "e015390f-8007-4371-8703-0b9ad853f718",
    "name": "Monitor API",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_exporter_id": "25186531"
  },
  "item": [
    {
      "name": "Check Cluster Health",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "const baseUrl = pm.environment.get(\"baseUrl\");",
              "const url = baseUrl + \"/actuator/health/cluster\";",
              "const numCalls = 4;",
              "const intervalMs = 3000;",
              "",
              "let callCount = 1;",
              "",
              "function checkResponse(res, count) {",
              "    pm.test(`Call ${count} status code should be 200`, () => {",
              "        pm.expect(res.code).to.equal(200);",
              "    });",
              "    return res.code === 200;",
              "}",
              "",
              "function nextCall() {",
              "    if (callCount < numCalls) {",
              "        setTimeout(() => {",
              "            pm.sendRequest(url, (err, res) => {",
              "                if (err) {",
              "                    pm.test(`Call ${callCount + 1} failed`, () => {",
              "                        pm.expect.fail(err.message || 'Request failed');",
              "                    });",
              "                } else if (checkResponse(res, callCount + 1)) {",
              "                    callCount++;",
              "                    nextCall();",
              "                }",
              "            });",
              "        }, intervalMs);",
              "    }",
              "}",
              "",
              "if (checkResponse(pm.response, 1)) {",
              "    nextCall();",
              "}"
            ],
            "type": "text/javascript",
            "packages": {},
            "requests": {}
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/actuator/health/cluster",
          "host": ["{{baseUrl}}"],
          "path": ["actuator", "health", "cluster"]
        }
      },
      "response": []
    }
  ],
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:8082"
    }
  ]
}
